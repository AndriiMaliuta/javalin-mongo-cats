<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cats</title>
        <link rel="stylesheet" href="../css/main.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        .container {
            display: flex;
            /*justify-content: center;*/
            flex-wrap: wrap;
        }
        .input {margin: 3px;}
        .button {background: chocolate;border-radius: 4px}
        .cat-div {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 200px;
            background: chocolate;
            margin: 5px;
            padding: 5px;
        }
        .cat-param {
            background-color: bisque;
            border-radius: 5px;
            padding: 4px;
            margin: 4px;
        }
        .hidden {display: none;}
        .show {display: block;}
        .error {display: block;color: orangered}
    </style>
</head>
<body>
<h2>Cats</h2>
<div class="container">

<!--    <th:block th:each="cat : ${cats}">-->
<!--        <div class="cat-div">-->
<!--            <p class="cat-param" th:text="${cat.id}"></p>-->
<!--            <p class="cat-param" th:text="${cat.name}"></p>-->
<!--            <p class="cat-param" th:text="${cat.age}"></p>-->
<!--            <p class="cat-param" th:text="${cat.color}"></p>-->
<!--        </div>-->
<!--    </th:block>-->

</div>
<br>
<button class="button" id="add-cat">Add Cat</button>
<br>
<div class="hidden-menu hidden">
    <form action="">
        <h4>Fill in Cat data</h4>
<!--        <label class="label" for="name">Name</label>-->
        <input class="input" type="text" id="name" name="name" placeholder="Name"><br>
        <p id="cat-name-error" class="hidden">Please enter Cat name</p>
<!--        <label class="label" for="age">Age</label>-->
        <input class="input" type="number" id="age" name="age" placeholder="Age"><br>
        <p id="cat-age-error" class="hidden">Please enter Cat age</p>
<!--        <label class="label" for="color">Color</label>-->
        <input class="input" type="text" id="color" name="color" placeholder="Color"><br>
        <p id="cat-color-error" class="hidden">Please enter Cat color</p>

        <button class="button" id="create-cat" type="submit">Create</button>
    </form>

</div>

<script>
    const name = document.getElementById("name");
    const age = document.getElementById("age");
    const color = document.getElementById("color");
    const createButton = document.getElementById("create-cat");
    const addButton = document.getElementById("add-cat");
    const modal = document.querySelector(".hidden-menu");
    const container = document.querySelector(".container");
    const catNameError = document.getElementById("cat-name-error");
    const catAgeError = document.getElementById("cat-age-error");
    const catColorError = document.getElementById("cat-color-error");

    function checkMenuErrors(cat) {
        if (cat.name === "" || cat.name === null) {
            catNameError.className = "error";
        }
        if (cat.age === 0) {
            catAgeError.className = "error";
        }
        if (cat.color === "" || cat.color === null) {
            catColorError.classList.add("error");
        }
    }

    addButton.addEventListener("click", (e) => {
        e.preventDefault();
        modal.classList.add("show")
    });

    createButton.addEventListener("click", (e) => {
        e.preventDefault();
        const cat = {
            name: name.value,
            age: age.value,
            color: color.value
        };
        checkMenuErrors(cat);
        console.log(cat.name, cat.age, cat.color);

        if (cat.name !== "" && cat.age !== "" && cat.color !== "") {
            axios.post("http://localhost:7000/rest/cats", cat)
                .then(response => console.log(response.data))
                .catch(error => console.error(error));
            populateCats();
        }
    });

    function populateCats() {
        container.innerHTML = "";
        let cats = [];
        axios.get("http://localhost:7000/rest/cats")
            .then(response => {
                cats = response.data;
                cats.forEach(cat => {
                    const catDiv = document.createElement("div");
                    catDiv.innerHTML = `
                        <div class="cat-div">
                            <p class="cat-param">${cat.id}</p>
                            <p class="cat-param">${cat.name}</p>
                            <p class="cat-param">${cat.age}</p>
                            <p class="cat-param">${cat.color}</p>
                        </div>
                    `;
                    container.appendChild(catDiv)})
            }).catch(error => console.error(error));
    }

    populateCats();

</script>

</body>
</html>